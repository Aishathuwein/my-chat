<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Chat App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.14.0/dist/emoji-picker.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’¬</text></svg>">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p>Loading Secure Chat...</p>
    </div>

    <!-- Main App Container -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- User Profile -->
            <div class="user-profile">
                <div class="avatar-container">
                    <img id="user-avatar" src="" alt="Avatar" class="avatar">
                    <span id="online-status" class="online-dot"></span>
                </div>
                <div class="user-info">
                    <h3 id="username">Guest</h3>
                    <p id="user-email">Not logged in</p>
                </div>
                <button class="theme-toggle" id="theme-toggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>

            <!-- Search -->
            <div class="search-container">
                <input type="text" id="search-chats" placeholder="Search chats...">
                <button class="new-chat-btn" id="new-chat-btn" title="New Chat">
                    <i class="fas fa-plus"></i>
                </button>
            </div>

            <!-- Chat List -->
            <div class="chat-list" id="chat-list">
                <!-- Chats will be loaded here -->
                <div class="chat-list-header">
                    <h4>Conversations</h4>
                    <button class="new-group-btn" id="new-group-btn">
                        <i class="fas fa-users"></i> New Group
                    </button>
                </div>
                <div id="conversations-container"></div>
            </div>

            <!-- Bottom Menu -->
            <div class="sidebar-footer">
                <button class="sidebar-btn active" data-tab="chats">
                    <i class="fas fa-comment"></i>
                    <span>Chats</span>
                </button>
                <button class="sidebar-btn" data-tab="groups">
                    <i class="fas fa-users"></i>
                    <span>Groups</span>
                </button>
                <button class="sidebar-btn" data-tab="contacts">
                    <i class="fas fa-address-book"></i>
                    <span>Contacts</span>
                </button>
                <button class="sidebar-btn" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </button>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="main-chat">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="chat-info">
                    <div class="chat-avatar">
                        <img id="current-chat-avatar" src="" alt="">
                        <span id="chat-online-status" class="online-dot"></span>
                    </div>
                    <div class="chat-details">
                        <h3 id="current-chat-name">Select a chat</h3>
                        <p id="chat-status">Tap on a conversation to start chatting</p>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="action-btn" title="Voice Call">
                        <i class="fas fa-phone"></i>
                    </button>
                    <button class="action-btn" title="Video Call">
                        <i class="fas fa-video"></i>
                    </button>
                    <button class="action-btn" title="Search in Chat">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="action-btn" title="More Options">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
            </div>

            <!-- Messages Container -->
            <div class="messages-container" id="messages-container">
                <!-- Messages will appear here -->
                <div class="welcome-message">
                    <h2>Welcome to Secure Chat</h2>
                    <p>Select a conversation or start a new one to begin messaging.</p>
                    <p>All messages are end-to-end encrypted.</p>
                </div>
            </div>

            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typing-indicator">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <span id="typing-user">Someone is typing...</span>
            </div>

            <!-- Message Input Area -->
            <div class="message-input-area">
                <button class="input-action-btn" id="attach-btn" title="Attach File">
                    <i class="fas fa-paperclip"></i>
                </button>
                <button class="input-action-btn" id="emoji-btn" title="Emoji">
                    <i class="far fa-smile"></i>
                </button>
                
                <!-- Emoji Picker (Hidden by default) -->
                <div id="emoji-picker-container" class="emoji-picker-container">
                    <emoji-picker id="emoji-picker"></emoji-picker>
                </div>

                <!-- File Upload Preview -->
                <div id="upload-preview" class="upload-preview"></div>

                <div class="message-input-wrapper">
                    <textarea 
                        id="message-input" 
                        placeholder="Type your message..." 
                        rows="1"
                        autocomplete="off"
                    ></textarea>
                    
                    <!-- Voice Message Recorder -->
                    <div id="voice-recorder" class="voice-recorder">
                        <button id="voice-btn" class="voice-btn" title="Record Voice Message">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <div class="recording-indicator">
                            <span class="recording-dot"></span>
                            <span>Recording...</span>
                            <button id="stop-recording">Stop</button>
                        </div>
                        <audio id="voice-preview" controls></audio>
                    </div>
                </div>

                <button class="send-btn" id="send-btn" title="Send Message">
                    <i class="fas fa-paper-plane"></i>
                </button>

                <input type="file" id="file-input" multiple accept="image/*,video/*,.pdf,.doc,.docx,.txt" style="display: none;">
                <input type="file" id="image-input" accept="image/*" capture="environment" style="display: none;">
            </div>
        </div>

        <!-- Right Sidebar (Contacts/Group Info) -->
        <div class="right-sidebar" id="right-sidebar">
            <div class="right-sidebar-content" id="right-sidebar-content">
                <!-- Content will be loaded based on context -->
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <h2>Welcome to Secure Chat</h2>
            <p>Sign in to start messaging</p>
            <button id="google-login-btn" class="social-login-btn google">
                <i class="fab fa-google"></i> Continue with Google
            </button>
            <button id="github-login-btn" class="social-login-btn github">
                <i class="fab fa-github"></i> Continue with GitHub
            </button>
            <button id="email-login-btn" class="social-login-btn email">
                <i class="fas fa-envelope"></i> Continue with Email
            </button>
            <div class="modal-footer">
                <p>By continuing, you agree to our <a href="#">Terms</a> and <a href="#">Privacy Policy</a></p>
            </div>
        </div>
    </div>

    <div id="new-chat-modal" class="modal">
        <div class="modal-content">
            <h2>New Conversation</h2>
            <input type="text" id="search-users" placeholder="Search users...">
            <div id="users-list" class="users-list"></div>
        </div>
    </div>

    <div id="new-group-modal" class="modal">
        <div class="modal-content">
            <h2>Create New Group</h2>
            <input type="text" id="group-name" placeholder="Group name">
            <textarea id="group-description" placeholder="Group description (optional)"></textarea>
            <div id="group-members-select" class="members-select"></div>
            <button id="create-group-btn">Create Group</button>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="message-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2354.mp3"></audio>
    <audio id="send-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3"></audio>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.14.0/dist/emoji-picker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.js"></script>
    <script src="encryption.js"></script>
    <script src="script.js"></script>
</body>
</html>