<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University Chat</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash-screen">
        <div class="splash-content">
            <div class="logo">
                <div class="logo-icon">UZ</div>
                <h1>University Chat</h1>
            </div>
            <p>Secure Academic Communication Platform</p>
        </div>
    </div>

    <!-- Auth Screen -->
    <div id="auth-screen" class="screen">
        <div class="auth-container">
            <div class="auth-header">
                <div class="logo">
                    <div class="logo-icon">UZ</div>
                    <h2>University Chat</h2>
                </div>
                <p class="tagline">Academic Communication Platform</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="auth-form active">
                <div class="form-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="login-email" placeholder="University Email" value="student@university.ac.tz">
                </div>
                <div class="form-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="login-password" placeholder="Password" value="123456">
                    <button type="button" class="show-password" onclick="togglePassword('login-password')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <button id="login-btn" class="btn btn-primary" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                
                <div class="divider">
                    <span>or continue with</span>
                </div>
                
                <button id="google-btn" class="btn btn-google" onclick="loginWithGoogle()">
                    <i class="fab fa-google"></i> Google Account
                </button>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="auth-form">
                <div class="form-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="signup-name" placeholder="Full Name" value="John Doe">
                </div>
                <div class="form-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="signup-email" placeholder="University Email" value="newstudent@university.ac.tz">
                </div>
                <div class="form-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="signup-password" placeholder="Password" value="123456">
                    <button type="button" class="show-password" onclick="togglePassword('signup-password')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <div class="form-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="signup-confirm" placeholder="Confirm Password" value="123456">
                </div>
                <button id="signup-btn" class="btn btn-primary" onclick="signup()">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
            </div>

            <div class="auth-footer">
                <p>By continuing, you agree to our <a href="#">Terms</a> and <a href="#">Privacy Policy</a></p>
            </div>
        </div>
    </div>

    <!-- Chat Screen -->
    <div id="chat-screen" class="screen">
        <!-- Mobile Header -->
        <div class="mobile-header">
            <button class="menu-btn" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="chat-header-info">
                <h3 id="mobile-chat-title">Global Chat</h3>
                <p id="mobile-chat-status">Online: 0</p>
            </div>
            <button class="user-menu-btn" onclick="toggleUserMenu()">
                <i class="fas fa-ellipsis-v"></i>
            </button>
        </div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <!-- User Profile -->
            <div class="user-profile">
                <div class="profile-main">
                    <div class="avatar" id="user-avatar">JD</div>
                    <div class="user-info">
                        <h4 id="user-name">Loading...</h4>
                        <p class="user-status" id="user-status">Online</p>
                    </div>
                    <button class="logout-btn" onclick="logout()" title="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>

            <!-- Search -->
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="Search chats..." oninput="searchChats()">
            </div>

            <!-- Navigation -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('chats')">
                    <i class="fas fa-comments"></i>
                    <span>Chats</span>
                </button>
                <button class="nav-tab" onclick="switchTab('contacts')">
                    <i class="fas fa-users"></i>
                    <span>Contacts</span>
                </button>
                <button class="nav-tab" onclick="switchTab('groups')">
                    <i class="fas fa-user-friends"></i>
                    <span>Groups</span>
                </button>
            </div>

            <!-- Chats List -->
            <div class="chats-list" id="chats-section">
                <div class="section-header">
                    <h4>Recent Chats</h4>
                    <button class="new-chat-btn" onclick="startNewChat()">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div id="chats-container">
                    <!-- Chats will be loaded here -->
                </div>
            </div>

            <!-- Contacts List -->
            <div class="contacts-list" id="contacts-section" style="display: none;">
                <div class="section-header">
                    <h4>Online Users</h4>
                    <span class="online-count" id="online-count">0</span>
                </div>
                <div id="contacts-container">
                    <!-- Contacts will be loaded here -->
                </div>
            </div>

            <!-- Groups List -->
            <div class="groups-list" id="groups-section" style="display: none;">
                <div class="section-header">
                    <h4>Your Groups</h4>
                    <button class="create-group-btn" onclick="showCreateGroupModal()">
                        <i class="fas fa-plus"></i> New
                    </button>
                </div>
                <div id="groups-container">
                    <!-- Groups will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="main-chat">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="chat-info">
                    <div class="chat-avatar" id="chat-avatar">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="chat-details">
                        <h3 id="chat-title">Global Chat</h3>
                        <p id="chat-status">Public group â€¢ Everyone can join</p>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="chat-action-btn" onclick="showChatInfo()" title="Chat Info">
                        <i class="fas fa-info-circle"></i>
                    </button>
                    <button class="chat-action-btn" onclick="showAttachmentMenu()" title="Attach File">
                        <i class="fas fa-paperclip"></i>
                    </button>
                </div>
            </div>

            <!-- Messages Container -->
            <div class="messages-container" id="messages-container">
                <div class="messages" id="messages">
                    <div class="welcome-message">
                        <h4>Welcome to Global Chat!</h4>
                        <p>Start chatting with everyone in the university</p>
                    </div>
                </div>
            </div>

            <!-- Attachment Menu -->
            <div class="attachment-menu" id="attachment-menu">
                <button class="attach-btn" onclick="attachFile('image')">
                    <i class="fas fa-image"></i>
                    <span>Photo</span>
                </button>
                <button class="attach-btn" onclick="attachFile('audio')">
                    <i class="fas fa-microphone"></i>
                    <span>Audio</span>
                </button>
                <button class="attach-btn" onclick="attachFile('file')">
                    <i class="fas fa-file"></i>
                    <span>File</span>
                </button>
                <button class="attach-btn" onclick="attachFile('camera')">
                    <i class="fas fa-camera"></i>
                    <span>Camera</span>
                </button>
            </div>

            <!-- Message Input -->
            <div class="message-input-area">
                <button class="emoji-btn" onclick="toggleEmojiPicker()">
                    <i class="far fa-smile"></i>
                </button>
                <div class="input-wrapper">
                    <input type="text" 
                           id="message-input" 
                           placeholder="Type your message..." 
                           onkeypress="if(event.key === 'Enter') sendMessage()">
                    <div class="emoji-picker" id="emoji-picker">
                        <!-- Emojis will be added here -->
                    </div>
                </div>
                <button class="send-btn" id="send-btn" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
                <button class="voice-btn" id="voice-btn" onclick="toggleVoiceRecording()">
                    <i class="fas fa-microphone"></i>
                </button>
            </div>

            <!-- Audio Recorder -->
            <div class="audio-recorder" id="audio-recorder">
                <div class="recorder-header">
                    <span>Recording audio...</span>
                    <button onclick="cancelRecording()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="recorder-timer">
                    <span id="recording-timer">00:00</span>
                </div>
                <button class="stop-recording" onclick="stopRecording()">
                    <i class="fas fa-stop-circle"></i>
                </button>
            </div>
        </div>

        <!-- User Menu (Mobile) -->
        <div class="user-menu" id="user-menu">
            <div class="menu-header">
                <h4>Menu</h4>
                <button onclick="toggleUserMenu()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="menu-items">
                <a href="#" onclick="showProfile()">
                    <i class="fas fa-user"></i>
                    <span>My Profile</span>
                </a>
                <a href="#" onclick="showSettings()">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
                <a href="#" onclick="showNotifications()">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                </a>
                <a href="#" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>

        <!-- Overlay -->
        <div class="overlay" id="overlay" onclick="closeAllModals()"></div>
    </div>

    <!-- Modals -->
    <div class="modal" id="new-chat-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>New Chat</h3>
                <button onclick="closeModal('new-chat-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="user-search" placeholder="Search users..." oninput="searchUsers()">
                </div>
                <div class="users-list" id="users-list">
                    <!-- Users will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="create-group-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Group</h3>
                <button onclick="closeModal('create-group-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" id="group-name" placeholder="Group Name">
                </div>
                <div class="form-group">
                    <textarea id="group-description" placeholder="Description (optional)"></textarea>
                </div>
                <div class="form-group">
                    <label>Select Members:</label>
                    <div class="members-list" id="group-members-list">
                        <!-- Members will be loaded here -->
                    </div>
                </div>
                <button class="btn btn-primary" onclick="createGroup()">
                    <i class="fas fa-plus-circle"></i> Create Group
                </button>
            </div>
        </div>
    </div>

    <div class="modal" id="chat-info-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Chat Information</h3>
                <button onclick="closeModal('chat-info-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="chat-info-details" id="chat-info-details">
                    <!-- Chat info will be loaded here -->
                </div>
                <div class="chat-actions-list" id="chat-actions-list">
                    <!-- Chat actions will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- File Input (hidden) -->
    <input type="file" id="file-input" style="display: none;" accept="image/*,audio/*,video/*,.pdf,.doc,.docx,.txt">
    <input type="file" id="image-input" style="display: none;" accept="image/*" capture="environment">

    <!-- Notifications -->
    <div class="notifications" id="notifications"></div>

    <!-- Install Prompt -->
    <div class="install-prompt" id="install-prompt">
        <div class="prompt-content">
            <i class="fas fa-download"></i>
            <div class="prompt-text">
                <h4>Install University Chat</h4>
                <p>Install for better experience</p>
            </div>
            <button class="btn-install" onclick="installApp()">Install</button>
            <button class="btn-close" onclick="closeInstallPrompt()">&times;</button>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="firebase-config.js"></script>
    <script src="app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        // Handle install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            setTimeout(() => {
                document.getElementById('install-prompt').style.display = 'flex';
            }, 3000);
        });

        window.installApp = function() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted install');
                    }
                    deferredPrompt = null;
                    document.getElementById('install-prompt').style.display = 'none';
                });
            }
        };

        window.closeInstallPrompt = function() {
            document.getElementById('install-prompt').style.display = 'none';
        };
    </script>
</body>
</html>